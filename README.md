# Windows Uninstaller

IObit Uninstallerのような高機能なWindowsアンインストーラー。Pythonで実装された、強力な残留物削除機能を持つアプリケーションアンインストーラーです。

## 特徴

- **完全なアンインストール**: プログラムと関連する全てのファイル、レジストリエントリを削除
- **32bit/64bit両対応**: 両アーキテクチャのアプリケーションに対応
- **残留物スキャン**: アンインストール後の残留ファイル・レジストリを検出
- **バックアップ機能**: システム復元ポイントとレジストリのバックアップ
- **詳細なログ記録**: 全ての操作を詳細にログに記録
- **GUI + CLI**: グラフィカルインターフェースとコマンドラインの両方に対応

## 現在の実装状況 (Phase 7 完了!)

✅ **Phase 1 完了:**
- プロジェクト構造とインフラ
- レジストリ読み取り (32bit/64bit対応)
- インストール済みプログラム一覧取得
- システム情報取得
- 権限管理 (管理者権限チェック)
- ロギングシステム
- バックアップシステム (システム復元ポイント、レジストリ、ファイル)
- 基本的なCLIインターフェース

✅ **Phase 2 完了:**
- **アンインストール実行エンジン** - UninstallString/MSI両対応
- **残留物スキャナー** - ファイル、レジストリ、ショートカットを検出
- **安全な削除機能** - バックアップ付き残留物削除
- **拡張CLIコマンド** - `uninstall`, `scan`, `clean` コマンド

✅ **Phase 3 完了:**
- **PyQt6 GUI実装** - モダンなグラフィカルインターフェース
- **メインウィンドウ** - プログラム一覧、検索、並び替え機能
- **アイコン表示** - プログラムアイコンの自動抽出と表示
- **アンインストールダイアログ** - 進捗表示、ログ出力、自動残留物削除
- **残留物スキャンダイアログ** - 独立した残留物スキャン・削除機能
- **マルチスレッド処理** - ノンブロッキングなUI操作

✅ **Phase 4 完了:**
- **強制削除機能** - プロセス終了、ファイルロック解除、サービス停止
- **バッチアンインストール** - 複数プログラムの一括削除
- **頑固なアプリデータベース** - 10個の主要アプリの特別な処理定義
- **UWP/Windows Storeアプリ管理** - PowerShell経由でのUWPアプリ削除

✅ **Phase 5 完了:**
- **システムスナップショット** - インストール前後のシステム状態キャプチャ
- **ファイルシステム変更追跡** - 追加・変更・削除されたファイルの検出
- **レジストリ変更追跡** - レジストリキーと値の変更検出
- **インストールトレース保存** - 変更履歴の永続化とロード機能
- **完全削除サポート** - トレースを使用した完全なアンインストール

✅ **Phase 6 完了:**
- **設定管理** - JSON形式での設定の永続化
- **エクスポート機能** - CSV/JSON/HTML形式でのプログラム一覧エクスポート
- **統計とレポート** - アンインストール履歴と統計情報の追跡
- **GUI統合** - モニター、統計、エクスポート機能のGUI統合
- **アンインストールレポート** - 削除内容の詳細なHTMLレポート生成

✅ **Phase 7 完了:**
- **チェックボックス列** - 複数プログラムの選択が可能
- **バッチアンインストール** - 選択した複数プログラムの一括削除
- **テーブルヘッダークリックソート** - 列ヘッダーをクリックでソート（昇順/降順）
- **キーボードショートカット** - Delete、F5、Ctrl+F、Ctrl+A、Escape対応
- **システムトレイ統合** - 最小化時にトレイアイコン表示、常駐機能
- **トレイメニュー** - 表示、更新、終了の操作をトレイから実行可能

## システム要件

- **OS**: Windows 10/11 (64bit推奨)
- **Python**: 3.8以降
- **権限**: 管理者権限が必要

## インストール

### 方法1: Windows インストーラー（推奨）

**リリースページからインストーラーをダウンロード:**
- `WindowsUninstaller-Setup-0.7.0.exe` をダウンロード
- インストーラーを実行
- インストールウィザードに従ってインストール

**特徴:**
- Program Filesへの自動インストール
- スタートメニューへのショートカット作成
- デスクトップアイコン（オプション）
- アンインストーラーの自動登録

### 方法2: ポータブル版（EXE単体）

**リリースページからEXEをダウンロード:**
- `WindowsUninstaller.exe` をダウンロード
- 任意の場所に配置して実行

**特徴:**
- インストール不要
- USBメモリなどでの持ち運びが可能
- 実行するだけで使用可能

### 方法3: ソースコードから実行（開発者向け）

#### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

#### 2. (オプション) 開発用インストール

```bash
pip install -e .
```

## 使用方法

### CLIモード

#### プログラム一覧を表示

```bash
python main.py list
```

#### 検索してプログラムを表示

```bash
python main.py list --search "Adobe"
```

#### プログラムの詳細情報を表示

```bash
python main.py info "プログラム名"
```

#### プログラムをアンインストール ✨新機能✨

```bash
# 基本的なアンインストール
python main.py uninstall "プログラム名"

# サイレントモード（確認なし）
python main.py uninstall "プログラム名" --yes

# バックアップなしで実行
python main.py uninstall "プログラム名" --no-backup

# 残留物スキャンをスキップ
python main.py uninstall "プログラム名" --no-scan
```

#### 残留物をスキャン ✨新機能✨

```bash
# 残留物をスキャン（アンインストールせずに確認）
python main.py scan "プログラム名"

# ファイルスキャンのみ
python main.py scan "プログラム名" --no-registry --no-shortcuts

# レジストリスキャンのみ
python main.py scan "プログラム名" --no-files --no-shortcuts
```

#### 残留物を削除 ✨新機能✨

```bash
# 残留物を削除（手動アンインストール後に使用）
python main.py clean "プログラム名"

# 確認なしで削除
python main.py clean "プログラム名" --yes

# バックアップなしで削除
python main.py clean "プログラム名" --no-backup
```

#### システム情報を表示

```bash
python main.py sysinfo
```

#### 権限情報を表示

```bash
python main.py privileges
```

#### バックアップ一覧を表示

```bash
python main.py backups
```

#### 古いバックアップとログを削除

```bash
python main.py cleanup --keep-days 30
```

### GUIモード ✨新機能✨

**インストーラー版またはポータブル版:**
```bash
# スタートメニューまたはデスクトップアイコンから起動
# または、WindowsUninstaller.exe をダブルクリック
```

**ソースコードから:**
```bash
python main.py --gui
# または、引数なしで実行するとデフォルトでGUIモードで起動
python main.py
```

**GUI機能:**
- プログラム一覧の表示と検索（アイコン表示対応）
- チェックボックスによる複数選択
- バッチアンインストール（複数プログラムの一括削除）
- テーブルヘッダークリックソート（すべての列で昇順/降順）
- キーボードショートカット対応（Delete、F5、Ctrl+F、Ctrl+A、Escape）
- システムトレイ統合（最小化時にトレイアイコン表示、常駐機能）
- プログラムのアンインストール（進捗表示付き）
- 残留物の自動スキャンと削除
- リアルタイムログ出力
- 詳細情報の表示
- バックアップ管理

**キーボードショートカット:**
- `Delete`: 選択/チェックしたプログラムをアンインストール
- `F5`: プログラム一覧を更新
- `Ctrl+F`: 検索ボックスにフォーカス
- `Ctrl+A`: すべてのチェックボックスを切り替え
- `Escape`: 検索をクリア

## テスト

Phase 1の基本機能テスト:

```bash
python test_basic.py
```

Phase 2の機能テスト:

```bash
python test_phase2.py
```

Phase 3のGUI機能テスト:

```bash
python test_phase3.py
```

Phase 4の高度な削除機能テスト:

```bash
python test_phase4.py
```

Phase 5のインストールモニターテスト:

```bash
python test_phase5.py
```

Phase 6の追加機能テスト:

```bash
python test_phase6.py
```

## プロジェクト構造

```
uninstaller/
├── core/                    # コア機能
│   ├── registry.py         # レジストリ操作 ✅
│   ├── uninstaller.py      # アンインストール実行 ✅
│   ├── scanner.py          # 残留物スキャン ✅
│   ├── cleaner.py          # 削除機能 ✅
│   ├── force_delete.py     # 強制削除機能 ✅
│   ├── batch_uninstaller.py # バッチアンインストール ✅
│   ├── uwp_uninstaller.py  # UWP/Storeアプリ管理 ✅
│   └── monitor.py          # インストールモニター ✅
├── utils/                   # ユーティリティ
│   ├── backup.py           # バックアップ/復元 ✅
│   ├── logger.py           # ログ記録 ✅
│   ├── permissions.py      # 権限管理 ✅
│   ├── system_info.py      # システム情報取得 ✅
│   ├── icon_extractor.py   # アイコン抽出 ✅
│   ├── config.py           # 設定管理 ✅
│   ├── exporter.py         # エクスポート機能 ✅
│   └── statistics.py       # 統計とレポート ✅
├── gui/                     # GUIインターフェース ✅
│   ├── main_window.py      # メインウィンドウ ✅
│   └── widgets/            # カスタムウィジェット ✅
│       ├── uninstall_dialog.py  # アンインストールダイアログ ✅
│       ├── scan_dialog.py       # 残留物スキャンダイアログ ✅
│       └── monitor_dialog.py    # インストールモニターダイアログ ✅
├── cli/                     # CLIインターフェース ✅
│   └── commands.py         # コマンド定義 ✅
├── database/                # プログラムデータベース ✅
│   ├── stubborn_apps.json  # 頑固なアプリ情報 ✅
│   └── stubborn_apps.py    # データベースハンドラ ✅
├── tests/                   # テストコード
├── main.py                  # エントリーポイント ✅
├── test_basic.py            # 基本テスト ✅
└── README.md                # このファイル
```

## 主要機能の詳細

### レジストリ読み取り

`core/registry.py` - WindowsレジストリからインストールされたプログラムのCritical情報を取得

- 3つのレジストリパスをスキャン:
  - `HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall` (64bit)
  - `HKLM\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall` (32bit)
  - `HKCU\Software\Microsoft\Windows\CurrentVersion\Uninstall` (ユーザーレベル)

### バックアップシステム

`utils/backup.py` - 安全なアンインストールのためのバックアップ機能

- システム復元ポイントの作成
- レジストリキーのバックアップ (.regファイル)
- ファイル・ディレクトリのバックアップ (ZIP形式)
- バックアップの一覧表示と管理

### ロギング

`utils/logger.py` - 詳細な操作ログの記録

- コンソール出力とファイル出力
- 自動ログローテーション
- 操作履歴の追跡
- エラーの詳細記録

## 注意事項

⚠️ **重要**: このソフトウェアは開発中です。Phase 2まで完了し、基本的なアンインストール機能が実装されていますが、まだテスト段階です。**重要なシステムやデータは必ずバックアップを取ってから使用してください。**

⚠️ **管理者権限**: アンインストール操作には管理者権限が必要です。

⚠️ **バックアップ**: システムを変更する前に、必ずシステム復元ポイントを作成することをお勧めします（デフォルトで自動作成されます）。

⚠️ **テスト環境**: 本番環境で使用する前に、必ず仮想マシンやテスト環境で動作を確認してください。

## ライセンス

このプロジェクトは個人使用・学習目的で作成されています。

## 開発ロードマップ

- [x] Phase 1: 基礎インフラ (1-2週間) ✅ **完了**
- [x] Phase 2: 基本アンインストール機能 (1-2週間) ✅ **完了**
- [x] Phase 3: GUI実装 (2-3週間) ✅ **完了**
- [x] Phase 4: 高度な削除機能 (2週間) ✅ **完了**
- [x] Phase 5: インストールモニター (2-3週間) ✅ **完了**
- [x] Phase 6: 追加機能と最適化 (2週間) ✅ **完了**
- [x] Phase 7: GUI改善とシステム統合 (1-2週間) ✅ **完了**

**推定開発期間**: 11-16週間
**現在の進捗**: Phase 7 完了 (基本機能100%完成！)

**今後の拡張予定:**
- エクスプローラー右クリックメニュー統合
- バックグラウンドインストール監視の常駐化

## ビルド手順（開発者向け）

このセクションでは、EXEファイルとWindowsインストーラーのビルド方法を説明します。

### 前提条件

1. **PyInstaller** のインストール:
```bash
pip install pyinstaller
```

2. **Inno Setup** のインストール（インストーラー作成時のみ）:
   - ダウンロード: https://jrsoftware.org/isinfo.php
   - インストール先: `C:\Program Files (x86)\Inno Setup 6\`

### ビルド方法

#### 簡単な方法（バッチファイル使用）

1. **EXEファイルの作成:**
```batch
build_exe.bat
```
成果物: `dist\WindowsUninstaller.exe`

2. **Windowsインストーラーの作成:**
```batch
build_installer.bat
```
成果物: `Output\WindowsUninstaller-Setup-0.7.0.exe`

#### 手動ビルド

1. **EXEファイルの作成:**
```bash
pyinstaller windows-uninstaller.spec
```

2. **Windowsインストーラーの作成:**
```bash
"C:\Program Files (x86)\Inno Setup 6\ISCC.exe" installer.iss
```

### 詳細なビルド手順

詳しいビルド手順、トラブルシューティング、カスタマイズ方法については、[BUILD.md](BUILD.md) を参照してください。

### ビルドファイル

- `windows-uninstaller.spec` - PyInstallerの設定ファイル
- `version_info.txt` - EXEファイルのバージョン情報
- `installer.iss` - Inno Setupのインストーラースクリプト
- `build_exe.bat` - EXEビルドスクリプト
- `build_installer.bat` - インストーラービルドスクリプト

## 貢献

バグ報告や機能リクエストは、GitHubのIssuesで受け付けています。

---

**Version**: 0.7.0 (Phase 7 完了)
**Last Updated**: 2025-11-06

### 変更履歴

**v0.7.0 (2025-11-06)** - Phase 7 完了 - GUI改善とシステム統合
- バッチアンインストール: チェックボックスによる複数選択と一括削除
- テーブルヘッダークリックソート: すべての列で昇順/降順ソート可能
- キーボードショートカット: Delete、F5、Ctrl+F、Ctrl+A、Escape
- システムトレイ統合: 最小化時にトレイアイコン表示、常駐機能
- トレイメニュー: 表示、更新、終了操作をトレイから実行
- バッチアンインストールダイアログ: 進捗表示とログ出力
- GUI更新: 7列テーブル（チェックボックス、アイコン、名前、バージョン、発行元、サイズ、日付）
- バージョン管理統一: setup.pyとmain_window.pyを0.7.0に統一
- PyInstaller対応: EXE化のための設定ファイル（.spec）とビルドスクリプト
- Inno Setup対応: Windowsインストーラー作成スクリプト（.iss）
- ビルドドキュメント: BUILD.mdの追加、ビルド手順の詳細化
- デフォルトGUIモード: 引数なしで起動するとGUIモードで起動

**v0.6.0 (2025-11-06)** - Phase 6 完了 - 追加機能と最適化
- 設定管理: JSON形式での設定の永続化、deep copyによる安全な操作
- エクスポート機能: CSV、JSON、HTML形式でのプログラム一覧エクスポート
- 統計とレポート: アンインストール履歴の追跡、統計サマリー生成
- アンインストールレポート: 削除内容の詳細なHTMLレポート生成
- GUIインターフェース更新: モニター、統計、エクスポート機能の統合
- メニューバー機能追加: ファイル→エクスポート、ツール→モニター/統計
- テスト: 7/7テスト合格
- 全6フェーズ完了、プロジェクト100%達成

**v0.5.0 (2025-11-06)** - Phase 5 完了
- インストールモニター: システム状態のスナップショット機能
- ファイルシステム変更追跡: 追加・変更・削除の検出
- レジストリ変更追跡: キーと値の変更を詳細に記録
- インストールトレース: JSON形式での変更履歴保存・読み込み
- 完全アンインストール支援: トレースを使った残留物ゼロの削除
- テスト: 6/6テスト合格

**v0.4.0 (2025-11-06)** - Phase 4 完了
- 強制削除機能: プロセス検出・終了、サービス停止、再起動時削除
- バッチアンインストール: 複数プログラムの一括処理、進捗コールバック
- 頑固なアプリデータベース: Chrome、Firefox、Adobe等10個のアプリ定義
- UWP/Windows Storeアプリ管理: PowerShell経由での削除機能
- psutil依存関係追加
- テスト: 5/5テスト合格

**v0.3.0 (2025-11-06)** - Phase 3 完了
- PyQt6ベースのGUI実装
- メインウィンドウ: プログラム一覧、検索、フィルタリング、並び替え
- アイコン表示: プログラムアイコンの自動抽出と表示
- アンインストールダイアログ: 進捗表示、リアルタイムログ、自動残留物削除
- 残留物スキャンダイアログ: 独立したスキャン・削除機能
- マルチスレッド処理でノンブロッキングなUI
- テスト: 6/6テスト合格

**v0.2.0 (2025-11-06)** - Phase 2 完了
- アンインストール実行エンジン追加 (UninstallString/MSI対応)
- 残留物スキャナー追加 (ファイル、レジストリ、ショートカット)
- 安全な削除機能追加 (バックアップ付き)
- CLIコマンド追加: `uninstall`, `scan`, `clean`
- テスト結果: 1674個の残留物を検出可能

**v0.1.0 (2025-11-06)** - Phase 1 完了
- プロジェクト基礎構造
- レジストリ読み取り機能
- システム情報取得
- 権限管理
- ロギングとバックアップ
- 基本CLIコマンド: `list`, `info`, `sysinfo`, `privileges`
